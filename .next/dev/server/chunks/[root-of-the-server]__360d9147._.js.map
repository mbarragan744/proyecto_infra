{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/lib/jwt.ts"],"sourcesContent":["import \"server-only\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst secret = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\n\nexport async function signToken(payload: { userId: string; email: string }) {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setExpirationTime(\"7d\")\n    .setIssuedAt()\n    .sign(secret)\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const { payload } = await jwtVerify(token, secret)\n    return payload as { userId: string; email: string }\n  } catch (error) {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE3D,eAAe,UAAU,OAA0C;IACxE,OAAO,MAAM,IAAI,kKAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,WAAW,GACX,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/lib/auth.ts"],"sourcesContent":["import \"server-only\"\nimport { cookies } from \"next/headers\"\nimport { verifyToken } from \"./jwt\"\n\nexport async function getAuthUser() {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth_token\")?.value\n\n  if (!token) {\n    return null\n  }\n\n  const payload = await verifyToken(token)\n  return payload\n}\n\nexport async function requireAuth() {\n  const user = await getAuthUser()\n  if (!user) {\n    throw new Error(\"Unauthorized\")\n  }\n  return user\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAE7C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,MAAM,UAAU,MAAM,IAAA,2HAAW,EAAC;IAClC,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/app/api/orders/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/prisma\"\nimport { requireAuth } from \"@/lib/auth\"\n\nexport async function GET() {\n  try {\n    const auth = await requireAuth()\n\n    const orders = await prisma.order.findMany({\n      where: { userId: auth.userId },\n      include: {\n        items: {\n          include: {\n            product: true,\n          },\n        },\n      },\n      orderBy: { createdAt: \"desc\" },\n    })\n\n    return NextResponse.json({ orders })\n  } catch (error) {\n    console.error(\"[v0] Get orders error:\", error)\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const auth = await requireAuth()\n\n    const cart = await prisma.cart.findUnique({\n      where: { userId: auth.userId },\n      include: {\n        items: {\n          include: {\n            product: true,\n          },\n        },\n      },\n    })\n\n    if (!cart || cart.items.length === 0) {\n      return NextResponse.json({ error: \"Cart is empty\" }, { status: 400 })\n    }\n\n    // Check stock availability\n    for (const item of cart.items) {\n      if (item.product.stock < item.quantity) {\n        return NextResponse.json({ error: `Insufficient stock for ${item.product.name}` }, { status: 400 })\n      }\n    }\n\n    const total = cart.items.reduce((sum, item) => sum + item.product.price * item.quantity, 0)\n\n    // Create order\n    const order = await prisma.order.create({\n      data: {\n        userId: auth.userId,\n        total,\n        status: \"pending\",\n        items: {\n          create: cart.items.map((item) => ({\n            productId: item.productId,\n            quantity: item.quantity,\n            price: item.product.price,\n          })),\n        },\n      },\n      include: {\n        items: {\n          include: {\n            product: true,\n          },\n        },\n      },\n    })\n\n    // Update product stock\n    for (const item of cart.items) {\n      await prisma.product.update({\n        where: { id: item.productId },\n        data: {\n          stock: {\n            decrement: item.quantity,\n          },\n        },\n      })\n    }\n\n    // Clear cart\n    await prisma.cartItem.deleteMany({\n      where: { cartId: cart.id },\n    })\n\n    return NextResponse.json({ order }, { status: 201 })\n  } catch (error) {\n    console.error(\"[v0] Create order error:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,4HAAW;QAE9B,MAAM,SAAS,MAAM,yHAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACzC,OAAO;gBAAE,QAAQ,KAAK,MAAM;YAAC;YAC7B,SAAS;gBACP,OAAO;oBACL,SAAS;wBACP,SAAS;oBACX;gBACF;YACF;YACA,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAO;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,4HAAW;QAE9B,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,QAAQ,KAAK,MAAM;YAAC;YAC7B,SAAS;gBACP,OAAO;oBACL,SAAS;wBACP,SAAS;oBACX;gBACF;YACF;QACF;QAEA,IAAI,CAAC,QAAQ,KAAK,KAAK,CAAC,MAAM,KAAK,GAAG;YACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,2BAA2B;QAC3B,KAAK,MAAM,QAAQ,KAAK,KAAK,CAAE;YAC7B,IAAI,KAAK,OAAO,CAAC,KAAK,GAAG,KAAK,QAAQ,EAAE;gBACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,CAAC,uBAAuB,EAAE,KAAK,OAAO,CAAC,IAAI,EAAE;gBAAC,GAAG;oBAAE,QAAQ;gBAAI;YACnG;QACF;QAEA,MAAM,QAAQ,KAAK,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,OAAO,CAAC,KAAK,GAAG,KAAK,QAAQ,EAAE;QAEzF,eAAe;QACf,MAAM,QAAQ,MAAM,yHAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACtC,MAAM;gBACJ,QAAQ,KAAK,MAAM;gBACnB;gBACA,QAAQ;gBACR,OAAO;oBACL,QAAQ,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,OAAS,CAAC;4BAChC,WAAW,KAAK,SAAS;4BACzB,UAAU,KAAK,QAAQ;4BACvB,OAAO,KAAK,OAAO,CAAC,KAAK;wBAC3B,CAAC;gBACH;YACF;YACA,SAAS;gBACP,OAAO;oBACL,SAAS;wBACP,SAAS;oBACX;gBACF;YACF;QACF;QAEA,uBAAuB;QACvB,KAAK,MAAM,QAAQ,KAAK,KAAK,CAAE;YAC7B,MAAM,yHAAM,CAAC,OAAO,CAAC,MAAM,CAAC;gBAC1B,OAAO;oBAAE,IAAI,KAAK,SAAS;gBAAC;gBAC5B,MAAM;oBACJ,OAAO;wBACL,WAAW,KAAK,QAAQ;oBAC1B;gBACF;YACF;QACF;QAEA,aAAa;QACb,MAAM,yHAAM,CAAC,QAAQ,CAAC,UAAU,CAAC;YAC/B,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;QAC3B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAM,GAAG;YAAE,QAAQ;QAAI;IACpD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}