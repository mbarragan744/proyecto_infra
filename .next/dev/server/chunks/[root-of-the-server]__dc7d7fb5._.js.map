{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/lib/jwt.ts"],"sourcesContent":["import \"server-only\"\nimport { SignJWT, jwtVerify } from \"jose\"\n\nconst secret = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\n\nexport async function signToken(payload: { userId: string; email: string }) {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setExpirationTime(\"7d\")\n    .setIssuedAt()\n    .sign(secret)\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const { payload } = await jwtVerify(token, secret)\n    return payload as { userId: string; email: string }\n  } catch (error) {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE3D,eAAe,UAAU,OAA0C;IACxE,OAAO,MAAM,IAAI,kKAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,WAAW,GACX,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/lib/auth.ts"],"sourcesContent":["import \"server-only\"\nimport { cookies } from \"next/headers\"\nimport { verifyToken } from \"./jwt\"\n\nexport async function getAuthUser() {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth_token\")?.value\n\n  if (!token) {\n    return null\n  }\n\n  const payload = await verifyToken(token)\n  return payload\n}\n\nexport async function requireAuth() {\n  const user = await getAuthUser()\n  if (!user) {\n    throw new Error(\"Unauthorized\")\n  }\n  return user\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAE7C,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,MAAM,UAAU,MAAM,IAAA,2HAAW,EAAC;IAClC,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/app/api/cart/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/prisma\"\nimport { requireAuth } from \"@/lib/auth\"\n\n// üìå Obtener carrito\nexport async function GET() {\n  try {\n    const auth = await requireAuth()\n\n    let cart = await prisma.cart.findUnique({\n      where: { userId: auth.userId },\n      include: {\n        items: {\n          include: { product: true },\n        },\n      },\n    })\n\n    if (!cart) {\n      cart = await prisma.cart.create({\n        data: { userId: auth.userId },\n        include: {\n          items: { include: { product: true } },\n        },\n      })\n    }\n\n    const total = cart.items.reduce(\n      (sum, item) => sum + item.product.price * item.quantity,\n      0\n    )\n\n    return NextResponse.json({ cart, total })\n  } catch (error) {\n    console.error(\"Get cart error:\", error)\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n  }\n}\n\n// üìå Agregar producto al carrito\nexport async function POST(request: NextRequest) {\n  try {\n    const auth = await requireAuth()\n    const { productId, quantity = 1 } = await request.json()\n\n    if (!productId) {\n      return NextResponse.json({ error: \"Product ID is required\" }, { status: 400 })\n    }\n\n    const product = await prisma.product.findUnique({\n      where: { id: productId },\n    })\n\n    if (!product) {\n      return NextResponse.json({ error: \"Product not found\" }, { status: 404 })\n    }\n\n    // ‚ö†Ô∏è Si quieres manejar stock, descomenta esto:\n    // if (product.stock < quantity) {\n    //   return NextResponse.json({ error: \"Insufficient stock\" }, { status: 400 })\n    // }\n\n    let cart = await prisma.cart.findUnique({\n      where: { userId: auth.userId },\n    })\n\n    if (!cart) {\n      cart = await prisma.cart.create({\n        data: { userId: auth.userId },\n      })\n    }\n\n    const existingItem = await prisma.cartItem.findUnique({\n      where: {\n        cartId_productId: {\n          cartId: cart.id,\n          productId,\n        },\n      },\n    })\n\n    if (existingItem) {\n      await prisma.cartItem.update({\n        where: { id: existingItem.id },\n        data: { quantity: existingItem.quantity + quantity },\n      })\n    } else {\n      await prisma.cartItem.create({\n        data: {\n          cartId: cart.id,\n          productId,\n          quantity,\n        },\n      })\n    }\n\n    const updatedCart = await prisma.cart.findUnique({\n      where: { id: cart.id },\n      include: {\n        items: { include: { product: true } },\n      },\n    })\n\n    const total = updatedCart?.items.reduce(\n      (sum, item) => sum + item.product.price * item.quantity,\n      0\n    ) ?? 0\n\n    return NextResponse.json({ cart: updatedCart, total })\n  } catch (error) {\n    console.error(\"Add to cart error:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n\n// üìå Vaciar carrito\nexport async function DELETE() {\n  try {\n    const auth = await requireAuth()\n\n    const cart = await prisma.cart.findUnique({\n      where: { userId: auth.userId },\n    })\n\n    if (cart) {\n      await prisma.cartItem.deleteMany({\n        where: { cartId: cart.id },\n      })\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"Clear cart error:\", error)\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}