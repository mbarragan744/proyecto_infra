{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maria/Downloads/next-js-e-commerce-app/app/checkout/page.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\n\nimport { useState, useEffect } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { loadStripe } from \"@stripe/stripe-js\"\nimport { Elements, PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\"\nimport { Button } from \"@/components/ui/button\"\nimport useSWR from \"swr\"\nimport { toast } from \"@/hooks/use-toast\"\n\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!)\n\nconst fetcher = (url: string) => fetch(url).then((res) => res.json())\n\nfunction CheckoutForm({ orderId }: { orderId: string }) {\n  const stripe = useStripe()\n  const elements = useElements()\n  const router = useRouter()\n  const [isProcessing, setIsProcessing] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!stripe || !elements) {\n      return\n    }\n\n    setIsProcessing(true)\n\n    try {\n      const { error } = await stripe.confirmPayment({\n        elements,\n        redirect: \"if_required\",\n      })\n\n      if (error) {\n        toast({\n          title: \"Payment failed\",\n          description: error.message,\n          variant: \"destructive\",\n        })\n        setIsProcessing(false)\n        return\n      }\n\n      toast({\n        title: \"Payment successful!\",\n        description: \"Your order has been placed\",\n      })\n\n      router.push(`/orders/${orderId}`)\n    } catch (error) {\n      console.error(\"[v0] Payment error:\", error)\n      toast({\n        title: \"Error\",\n        description: \"Failed to process payment\",\n        variant: \"destructive\",\n      })\n      setIsProcessing(false)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <PaymentElement />\n      <Button type=\"submit\" className=\"w-full\" size=\"lg\" disabled={!stripe || isProcessing}>\n        {isProcessing ? \"Processing...\" : \"Pay Now\"}\n      </Button>\n    </form>\n  )\n}\n\nexport default function CheckoutPage() {\n  const router = useRouter()\n  const [orderId, setOrderId] = useState<string | null>(null)\n  const [clientSecret, setClientSecret] = useState<string | null>(null)\n  const { data: cartData } = useSWR(\"/api/cart\", fetcher)\n\n  useEffect(() => {\n    const createOrder = async () => {\n      try {\n        // Create order\n        const orderRes = await fetch(\"/api/orders\", {\n          method: \"POST\",\n        })\n\n        if (!orderRes.ok) {\n          const data = await orderRes.json()\n          throw new Error(data.error || \"Failed to create order\")\n        }\n\n        const orderData = await orderRes.json()\n        setOrderId(orderData.order.id)\n\n        // Create payment intent\n        const paymentRes = await fetch(\"/api/payments/create-intent\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ orderId: orderData.order.id }),\n        })\n\n        if (!paymentRes.ok) {\n          throw new Error(\"Failed to create payment intent\")\n        }\n\n        const paymentData = await paymentRes.json()\n        setClientSecret(paymentData.clientSecret)\n      } catch (error) {\n        console.error(\"[v0] Checkout error:\", error)\n        toast({\n          title: \"Error\",\n          description: \"Failed to initialize checkout\",\n          variant: \"destructive\",\n        })\n        router.push(\"/cart\")\n      }\n    }\n\n    if (cartData?.cart?.items?.length > 0) {\n      createOrder()\n    } else if (cartData?.cart?.items?.length === 0) {\n      router.push(\"/cart\")\n    }\n  }, [cartData, router])\n\n  if (!clientSecret || !orderId) {\n    return (\n      <div className=\"container flex min-h-[60vh] items-center justify-center py-8\">\n        <p className=\"text-muted-foreground\">Loading checkout...</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"container py-8\">\n      <div className=\"mx-auto max-w-2xl\">\n        <h1 className=\"mb-8 text-3xl font-bold\">Checkout</h1>\n\n        <div className=\"rounded-lg border bg-card p-6\">\n          <h2 className=\"mb-4 text-xl font-semibold\">Payment Details</h2>\n          <Elements\n            stripe={stripePromise}\n            options={{\n              clientSecret,\n              appearance: { theme: \"stripe\" },\n            }}\n          >\n            <CheckoutForm orderId={orderId} />\n          </Elements>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}